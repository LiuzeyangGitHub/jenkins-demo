
#!/bin/bash

PID=$(ps -ef | grep demo-0.0.1-SNAPSHOT | grep -v grep | awk '{ print $2 }')
if [ -z "$PID" ]
then
  echo demo-0.0.1-SNAPSHOT is already stopped
else
  echo kill $PID
  kill $PID
fi

echo "应用启动开始"
rm -rf /usr/local/test
mkdir /usr/local/test
touch /usr/local/test/spring.log
nohup /usr/java/jdk1.8.0_241/bin/java -jar /usr/local/demo-0.0.1-SNAPSHOT.jar >> /usr/local/test/spring.log &
tail -f /usr/local/test/spring.log | while read line
do
  is_startup=`echo $line|grep "Started DemoApplication in"|wc -l`
  echo $line
  if [ $is_startup -eq 1 ] ;
   then
   PID=$(ps -ef | grep 'tail -f /usr/local/test/spring.log' | grep -v grep | awk '{ print $2 }')
   kill -9 $PID
  fi
done
echo "应用启动完成"
